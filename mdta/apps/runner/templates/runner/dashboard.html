{% extends 'core/base.html' %}
{% block extrahead %}
<script>
{% include 'runner/dashboard.js' %}
$("#run-all-modal").on('submit', function(e) {
        e.preventDefault();
        console.log("form submitted!");
        create_post()
});

function create_post() {
    console.log("create post is working!"); // sanity check
    var $form = $('#run-all-modal');
    var submit = $('#submit');
    $.ajax({
        url: "run_all_modal/",
        type: "POST",
        dataType: 'json',
        data: $form.serialize(),
        beforeSend: function() {
           alert.fadeOut();
           submit.html('Sending....'); // change submit button text
        },
        success: function(data, textStatus, jqXHR){
            var div = $("#testcase");
            console.log(data);
            console.log("success");
            alert.html(data).fadeIn();
            $form.trigger('reset');
        },
        error: function (xhr, errmsg, err) {
            $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: " + errmsg +
                " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
            console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
        }
    });
}
</script>
{% endblock %}
{% block body %}
    <div class='container'>
        <div class='row'>
            <div id='suites' class='col-md-6'>
                <h2>Suites</h2>
                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                    {% for suite in suites %}
                        <div class="panel panel-primary">
                            <div class="panel-heading" role="tab" id="h-{{ forloop.counter }}">
                                <h4 class="panel-title">
                                    <a role="button" data-toggle="collapse" data-parent="#accordion" href="#c-{{ forloop.counter }}">{{ suite.name }}</a>
                                </h4>
                            </div>
                            <div id="c-{{ forloop.counter }}" class="panel-collapse collapse" role="tabpanel">
                                <ul class="list-group" id="lg-{{ forloop.counter }}">
                                    <li class="list-group-item">
                                        <strong>Run all</strong>
                                        <a href="#" data-toggle="modal" data-target="#run-all-modal" style="margin-left: 3em;" data-suite="{{ suite.id }}" class="btn btn-success btn-xs pull-right run-all-suite">
                                            Run <i class="fa fa-arrow-right"></i>
                                        </a>
                                    </li>
                                    {% for case in suite.cases %}
                                        <li class="list-group-item">
                                            {{ case.title }}
                                            <button style="margin-left: 3em;" data-case="{{ case.id }}" class="btn btn-success btn-xs pull-right run-btn">
                                                Run <i class="fa fa-arrow-right"></i>
                                            </button>
                                            <i class="fa fa-check-square text-success pull-right hidden"></i>
                                            <i class="fa fa-minus-square text-danger pull-right hidden"></i>
                                            <i class="fa fa-spin fa-spinner pull-right hidden"></i>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                {% include "runner/run_all_modal.html" %}
            </div>
            <div class='col-md-6'>
                <h2>Details</h2>
                <div id="testcase"></div>
                <div id="result"></div>
                <div id="run-all-text"></div>
            </div>
        </div>
    </div>
{% endblock %}
